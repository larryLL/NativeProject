

<!DOCTYPE html>
<html lang="en">
<head>

    <!--meta tags-->

    <meta charset="UTF-8">
    <meta name="description" content="Services Listing HTML5 CSS3 template">
    <meta name="keywords" content="HTML,CSS,XML,JavaScript, services, listing">
    <meta name="author" content="Ui-DesignLab">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--end meta tags-->

    <title>OldsMarket Item Detail</title>
    <!--stylesheets-->
    <link rel="stylesheet" href="vendor/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/css/animate.min.css">
    <link rel="stylesheet" href="vendor/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="vendor/OwlCarousel2-2.2.1/owl.carousel.min.css">
    <link rel="stylesheet" href="vendor/OwlCarousel2-2.2.1/owl.theme.green.min.css">
    <link rel="stylesheet" href="vendor/perfect-scrollbar/css/perfect-scrollbar.min.css">
    <link rel="stylesheet" href="css/app.css">
    <!--end stylesheets-->

    <!--google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Cairo%7CNosifer%7CPoppins%7CQuicksand:700%7CRaleway%7CTangerine%7CHind+Vadodara" rel="stylesheet">
    <!--end google fonts-->
    <style>
        .form-group a:not([href]):not([tabindex]){
            display: inline-block;
            padding: 5px 1rem;
            background: #51d251;
            font-size: 0.8rem;
            color: whitesmoke;
            border-radius: 3px;
            text-decoration: none;
            transition: background 500ms;
        }
        .add-to-cart i {
             color: inherit;
        }
        .add-to-cart:hover {
             background: #35349a;
            cursor: pointer;
        }
        button:hover{
            cursor: pointer;
        }
        .site-user-img img{
            width: 34px;
            height: 34px;
        }
    </style>
</head>
<body>
     


<!--navigation bars-->

<div class="sit-bg">
    <nav class="site-top-nav transparent">
        <div class="logo">
            <a href="index.html">
                <img src="img/logo.png" alt="">
                <strong>SchoolOldsMarket</strong>
            </a>
        </div>
        <ul class="site-menu">
            <li>
                <a href="index.html">主页 </a>
            </li>
            <li>
                <a href="#">商品搜索 <i class="fa fa-angle-down"></i></a>
                <ul class="nav-dropdown">
                    <li><a href="items.html">商品列表</a></li>
                    <li><a href="search-results.html">商品搜索</a></li>
                </ul>
            </li>
            <li><a href="#">控制面板 <i class="fa fa-angle-down"></i></a>
                <ul class="nav-dropdown">
                    <li><a href="dash-profile.html">个人信息</a></li>
                    <li><a href="dash-items.html">商品列表</a></li>
                    <li><a href="dash-sales.html">交易记录</a></li>
                </ul>
            </li>
            <li>
                <a href="cart.html">购物车</a>
            </li>
            <li>
                <!--<a href="login-register.html" class="ui-btn ui-btn-info">登陆 / 注册</a>-->
                <div class="site-user">
                    <div class="site-user-img">
                        <img src="img/avatar2.jpg" alt="">
                        <span class="online"></span>
                    </div>
                    <a href="dash-profile.html" class="user-name"><strong>Emma Viola</strong></a>
                </div>
            </li>
        </ul>
        <i class="nav-toggle fa fa-bars"></i>
    </nav>
</div>
<div id="side-nav" class="side-nav">
    <div class="side-nav-menu perfect-scroll">
        <div class="text-logo">
            <a href="index.html"><h3>SOM平台</h3></a>
        </div>
        <div class="site-user">
            <div class="site-user-img">
                <img src="img/avatar2.jpg" alt="">
                <span class="online"></span>
            </div>
            <a href="#" class="user-name"><strong>Emma Viola</strong></a>
        </div>
        <ul class="menu">
            <li><a href="index.html" class="current">首页</a></li>
            <li><a href="items.html">商品列表</a></li>
        </ul>
        <div class="logout"><a href="login-register.html">退出登陆</a></div>
    </div>
</div>
<!--end navigation bars-->


<!--item-->
<div class="detail-wrapper">
    <!--item details-->
    <div class="item-details">
        <img src="img/items/item-detail.jpg" alt="">
        <div class="title-price">
            <strong class="titlet">老式大众</strong>
            <span>起价: <strong class="price">$4999</strong></span>
        </div>

        <div class="item-status">
            <div class="status-box">
                <strong>发布日期</strong>
                <span>12, Jan 2017</span>
            </div>
            <div class="status-box"></div>
        </div>

        <p class="description">
            <strong>商品介绍</strong>
            <span class="detail">
                Doner sirloin boudin filet mignon capicola.
                Pancetta ham beef ribs jowl kevin. Doner sirloin
                boudin filet mignon capicola. <i class="ui-text-info">Shankle ham hock
                turkey</i> biltong t-bone.Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                <br>
                Shankle ham hock
                turkey biltong t-bone.Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                <br>
                <br>
                Pancetta ham beef ribs jowl kevin. Doner sirloin
                boudin filet mignon capicola. Shankle ham hock
                turkey biltong t-bone.Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
                Shankle ham hock turkey biltong t-bone.
            </span>

            <a href="#" class="show-more"><i class="fa fa-angle-double-down"></i></a>
        </p>
        <!--<div class="item-features">
            <div class="feat">
                <i class="fa fa-check-circle ui-text-info"></i>
                <span>Shankle ham hock turkey</span>
            </div>
            <div class="feat">
                <i class="fa fa-check-circle ui-text-info"></i>
                <span>Shankle ham hock turkey</span>
            </div>
            <div class="feat">
                <i class="fa fa-check-circle ui-text-info"></i>
                <span>Shankle ham hock turkey</span>
            </div>
            <div class="feat">
                <i class="fa fa-check-circle ui-text-info"></i>
                <span>Shankle ham hock turkey</span>
            </div>
            <div class="feat">
                <i class="fa fa-check-circle ui-text-info"></i>
                <span>Shankle ham hock turkey</span>
            </div>
        </div>-->

        <div class="owner-msg">
            <strong>发布人消息</strong>
            <p>
                <i class="fa fa-quote-left ui-text-success"></i>
                <span>
                    您好，感谢您浏览我的商品。 如果你对我的商品感兴趣， <br>
                    需要购买这个商品, 请发消息给我， <br>我尽快给你回复!
                </span>
                <i class="fa fa-quote-right ui-text-success"></i>
            </p>
        </div>

        <!--<div class="share-item">
            <strong>Share</strong>
            <div>
                <a href="#"><strong>Twitter</strong> <i class="fa fa-twitter"></i></a>
                <a href="#"><strong>Facebook</strong> <i class="fa fa-facebook-f"></i></a>
                <a href="#"><strong>Googleplus</strong> <i class="fa fa-google-plus"></i></a>
                <a href="#"><strong>Pinterest</strong> <i class="fa fa-pinterest-p"></i></a>
            </div>
        </div>-->
        <!--<hr>-->
        <!--<div class="similar-items">
            <strong>Related Items</strong>
            <div>
                <div class="rel-item">
                    <img src="img/item2.jpg" alt="">
                    <a href="item-detail.html">Item Name</a>
                </div>
                <div class="rel-item">
                    <img src="img/item3.jpg" alt="">
                    <a href="item-detail.html">Item Name</a>
                </div>
                <div class="rel-item">
                    <img src="img/item5.jpg" alt="">
                    <a href="item-detail.html">Item Name</a>
                </div>
                <div class="rel-item">
                    <img src="img/item6.jpg" alt="">
                    <a href="item-detail.html">Item Name</a>
                </div>
            </div>
        </div>-->
    </div>
    <!--end item details-->

    <!--item aside details-->
    <div class="item-detail-aside">
        <div class="listed-by">
            <strong>发布人:</strong>
            <div class="lister">
                <img src="" width="134px" height="134px" alt="">
            </div>
        </div>
        <div class="lister-info">
            <center><strong style="font-size: 20px">姓名</strong></center>
            <hr>
            <span class="telephone"><i class="fa fa-phone ui-text-warn"></i> <em>+1 2568 752 819, +254 728101752</em></span>
            <span class="address"><i class="fa fa-map-marker ui-text-success"></i> <em>10100, New York USA</em></span>
            <!--<span><i class="fa fa-money ui-text-info"></i> <a href="#">www.example.com</a></span>-->
            <span><i class="fa fa-envelope-o ui-text-danger"></i> <a href="mailto:megan@example.com">megan@example.com</a></span>
            <hr>
        </div>
        <div class="contact-lister">
            <strong>商品交易</strong>
            <form action="#" method="post">
                <!--<div class="form-group">
                    <label for="email">To:</label>
                    <input id="email" type="email" placeholder="megan@example.com" class="form-control" disabled>
                </div>
                <div class="form-group">
                    <label for="sub">主题:</label>
                    <input id="sub" type="text" placeholder="See and take a test drive" class="form-control">
                </div>-->
                <div class="form-group">
                    <label for="msg">地点:</label>
                    <textarea id="msg" name="msg" placeholder="Message here..." rows="6" class="form-control" disabled></textarea>
                </div>
                <div class="form-group">
                    <label>操作:</label>
                    <br>
                    <div id="option">
                        <center><a class="add-to-cart">加入购物车 <i class="fa fa-cart-plus"></i></a></center>
                        <br>
                        <button class="ui-btn ui-btn-info form-control" id="pay" type="button" >立即下单 <i class="fa fa-paypal"></i></button>
                    </div>


                </div>
                <!--<label class="label&#45;&#45;checkbox">
                    <input type="checkbox" class="checkbox" checked>
                    <i>Get notified by email when <em class="ui-text-info">Megan</em> replies?</i>
                </label>-->
            </form>
        </div>
    </div>
    <!--end item aside details-->

</div>
<!--end item-->


<!--chat box-->
<!--<a href="#" class="chat-box-btn"><i class="fa fa-comment icon-sw"></i></a>-->

<!--<div class="chat-box">
    <div class="chat-top">
        <section>
            <h6 class="org-name">OldsMarket</h6>
            <div class="repliers">
                <div class="r-img">
                    <img src="img/avatar2.jpg" alt="">
                    <strong class="name">Megan</strong>
                </div>
                <div class="r-img">
                    <img src="img/user2.jpg" alt="">
                    <strong class="name">Brandon</strong>
                </div>
            </div>
        </section>
    </div>
    <div class="chat-flow" id="chat-flow">
        <p class="outbound">
            Hallo, Anyone there?
        </p>
        <p class="inbound">
            Hi, Vincent here. How may I be of service.
        </p>
    </div>
    <form class="chat-form" action="#">
        <input type="text" class="form-control chat-message" placeholder="Send a Message">
    </form>
</div>-->

<!--end chat box-->

<!--page loader-->
<div class="page-loader">
    <div class="loader"><img src="img/logo.png" alt=""></div>
</div>
<!--end page loader-->

<!--footer section-->
<footer class="footer">
    <div class="footer-item">
        <strong>取得联系</strong>
        <a href="#"><i class="fa fa-angle-right"></i> 支持</a>
        <a href="#"><i class="fa fa-angle-right"></i> 通知</a>
        <a href="#"><i class="fa fa-angle-right"></i> 社区论坛</a>
        <a href="#"><i class="fa fa-angle-right"></i> 联盟伙伴</a>
        <a href="#"><i class="fa fa-angle-right"></i> 联系我们</a>
    </div>
    <div class="footer-item">
        <strong>疑问?</strong>
        <a href="#"><i class="fa fa-angle-right"></i> 帮助</a>
        <a href="#"><i class="fa fa-angle-right"></i> 联系</a>
        <a href="#"><i class="fa fa-angle-right"></i> 在线客服</a>
    </div>
    <div class="footer-item">
        <strong>相关网站</strong>
        <a href="#"><i class="fa fa-angle-right"></i> 脸谱网</a>
        <a href="#"><i class="fa fa-angle-right"></i> 微博</a>
        <a href="#"><i class="fa fa-angle-right"></i> 网络相册</a>
        <a href="#"><i class="fa fa-angle-right"></i> 视频网站</a>
        <a href="#"><i class="fa fa-angle-right"></i> 人际关系网</a>
    </div>
    <div class="footer-item">
        <strong>资源连接</strong>
        <a href="#"><i class="fa fa-angle-right"></i> 首页</a>
        <a href="#"><i class="fa fa-angle-right"></i> 产品</a>
        <a href="#"><i class="fa fa-angle-right"></i> 服务</a>
        <a href="#"><i class="fa fa-angle-right"></i> 关于我们</a>
    </div>
</footer>
<div class="bottom-strip">
    <div class="cards-accepted">
        <em>Cards Accepted:</em>
        <img src="img/card-logos.png" alt="">
    </div>
    <div class="copyright"><i class="fa fa-copyright"></i> <span>SchoolOldsMarket. 拥有相关所有权</span></div>
    <div class="country"><!--<span>C.N</span><img src="img/USAFlag.png" alt="">--></div>
</div>
<!--end footer section-->

<!--scripts-->
<script src="vendor/js/jquery-3.2.1.min.js"></script>
<script src="vendor/js/popper.js"></script>
<script src="vendor/js/bootstrap.min.js"></script>
<script src="vendor/js/alertify.js"></script>
<script src="vendor/js/jquery.knob.min.js"></script>
<!--[if IE]><script type="text/javascript" src="vendor/js/excanvas.js"></script><![endif]-->
<script src="vendor/js/summernote-bs4.min.js"></script>
<script src="vendor/js/dropzone.js"></script>
<script src="vendor/OwlCarousel2-2.2.1/owl.carousel.min.js"></script>
<script src="vendor/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="vendor/js/typed.js"></script>
<script src="js/app.js"></script>
<!--end scripts-->
<script>

    /**
     * 时间戳转日期格式
     */
    function formatDate(timestamp) {
        var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
        var Y = date.getFullYear() + '-';
        var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        var D = date.getDate() + ' ';
        return Y+M+D;
    }

    var goodsId = sessionStorage.getItem("goodsId");
    var detailItem = null;
    if(goodsId == null){
        alert("没有商品信息记录！");
        window.location.href = "index.html";
    }else{
        $.ajax({
            url:"http://localhost:8080/ctp/goods/"+goodsId,
            type:"get",
            success:function (result) {
                console.log(result);
                if(result.code == 1){
                    detailItem = result.obj;
                    $(".item-details").find("img").attr("src","img/items/"+detailItem.image);
                    $(".titlet").text(detailItem.goodsName);
                    $(".price").text("$"+detailItem.goodsPrice);
                    $(".detail").text(detailItem.goodsDetail);
                    //item-status
                    $(".item-status").empty();
                    var stausHtml = "<div class='status-box'>\n" +
                        "                <strong>发布日期</strong>\n" +
                        "                <span>"+formatDate(detailItem.registerTime)+"</span>\n" +
                        "            </div>" +
                        "            <div class='status-box'>\n" +
                        "                <strong>商品原价</strong>\n" +
                        "                <span>"+detailItem.goodsOriginalPrice+"</span>\n" +
                        "            </div>"+
                        "            <div class='status-box'>\n" +
                        "                <strong>商品新旧程度</strong>\n" +
                        "                <span>"+detailItem.goodsDegree+"</span>\n" +
                        "            </div>"+
                        "            <div class='status-box'>\n" +
                        "                <strong>商品剩余数量</strong>\n" +
                        "                <span>"+detailItem.goodsQuantity+"</span>\n" +
                        "            </div>";
                    $(".item-status").append(stausHtml);

                    $(".lister").find("img").attr("src","img/userimg/"+detailItem.user.headPortrait);
                    $(".lister-info").find("strong").text(detailItem.user.userName);
                    $(".lister-info").find(".telephone").find("em").text("+"+detailItem.user.telephone);
                    $(".lister-info").find(".address").find("em").text(detailItem.user.address);

                    $(".lister-info").find("a").attr("href","mailto:"+detailItem.user.email);
                    $(".lister-info").find("a").text(detailItem.user.email);
                    $("#msg").val(detailItem.tradingPlace);



                    /**
                     * 登陆验证
                     */
                    var checkLogin = sessionStorage.getItem("userInfo");
                    if(checkLogin!=null && checkLogin != "undefined"){
                        userInfo = JSON.parse(checkLogin);
                        if(userInfo.userName == detailItem.user.userName){
                            $("#option").empty();
                            $("#option").html("<center style='color:red'>您是该商品的发布人，无法进行添加购物车、下单操作！</center>")
                        }
                    }

                }else{
                    alert("商品详情加载失败！");
                    window.location.href = "index.html";
                }

            },
            error:function () {
                alert("商品详情加载失败！");
                window.location.href = "index.html";
            }
        });
    }

    /**
     * 加入购物车按钮
     */
    $(".add-to-cart").on("click",function () {

        //首先判断是否登陆
        var checkLogin = sessionStorage.getItem("userInfo");
        if(checkLogin == null && checkLogin != "undefined"){
            alert("未登录，请先登陆！");
            window.location.href="login-register.html";
        }else {
            var cart = [];
            var item = {
                goodsNumber:detailItem.goodsNumber,
                goodsName: detailItem.goodsName,
                goodsPrice: detailItem.goodsPrice,
                goodsImage: detailItem.image,
                bayNumber: 1
            };
            if ($.cookie("cart") != null) {
                cart = JSON.parse($.cookie("cart"));
                var haveGoods = false;
                for (var i = 0; i < cart.length; i++) {
                    if (cart[i].goodsName == item.goodsName) {
                        haveGoods = true;
                        break;
                    }
                }
                if (!haveGoods) {
                    cart.push(item);
                    $.cookie("cart", JSON.stringify(cart));
                    alertify.success("已添加至购物车！");
                } else {
                    alertify.error("购物车已有该商品!");
                }
                console.log(cart);
            } else {
                cart.push(item);
                $.cookie("cart", JSON.stringify(cart));
            }
        }
    });

    /**
     * 下单按钮
     */
    $("#pay").click(function () {

        var checkLogin = sessionStorage.getItem("userInfo");
        var userInfo = JSON.parse(checkLogin);
        if(checkLogin == null && checkLogin != "undefined"){
            alert("未登录，请先登陆！");
            window.location.href="login-register.html";
        }else{
            if(null == userInfo.identity || ""==userInfo.identity || undefined == userInfo.identity ){
                alertify.error("个人信息未完善，无法进行商品下单！请完善个人信息！");
            }else{
                var cartGoods = $.cookie("cart");
                //购物车是否有商品标识，默认false：没有
                var flag = false;
                if(cartGoods != null && cartGoods != "[]" && cartGoods != "null" ){
                    var cartData = JSON.parse(cartGoods);
                    for(var i = 0;i<cartData.length;i++){
                        if(cartData[i].goodsNumber == detailItem.goodsNumber && !flag){
                            flag = true;
                            break;
                        }
                    }
                }

                /**
                 * 下单Ajax
                 **/
                var orderAjax = function () {
                    $.ajax({
                        url:"http://localhost:8080/ctp/order/0",
                        type:"post",
                        dataType:"json",
                        data:{
                            goodsNumber : detailItem.goodsNumber,
                            bayNumber : 1,
                            buyerId:userInfo.id
                        },
                        success:function (result) {
                            console.log(result);
                            if(result.success){
                                alertify.success("下单成功！");
                                //window.location.href = "order-success.html";
                            }else{
                                alertify.error(result.message);
                            }

                        },error:function () {
                            console.log("下单请求失败！");
                        }
                    });
                };

                if(flag){
                    alertify.confirm("购物车已有本商品，确认要下单吗？",function () {
                        orderAjax();
                        alertify.success("下单成功");
                    },function () {
                        alertify.error("已取消订单操作");
                    });
                }else{
                    alertify.confirm("确定需要下单吗？默认数量为1",function () {
                        orderAjax();
                        alertify.success("下单成功");
                        //window.location.href = "order-success.html";
                    },function () {
                        alertify.error("已取消订单操作");
                    });
                }

            }
        }


    });



    /**
     * 登陆人的用户信息显示
     * @type {string | null}
     */
    var checkLogin = sessionStorage.getItem("userInfo");
    if(checkLogin == null){

        console.log("login信息为空");
        $(".site-top-nav .site-menu > li:last-child").empty();
        var html = "";

        html += "<a href='login-register.html' class='ui-btn ui-btn-info'>登陆 / 注册</a>";

        $(".site-top-nav .site-menu > li:last-child").append(html);

    }else{
        console.log(checkLogin);
        var userInfo = JSON.parse(checkLogin);
        $(".site-top-nav .site-menu > li:last-child").empty();
        var html = "";

        html += "<div class='site-user'>\n" +
            "                    <div class='site-user-img'>\n" +
            "                        <img src='img/userimg/"+userInfo.headPortrait+"' alt=''>\n" +
            "                        <span class='online'></span>\n" +
            "                    </div>\n" +
            "                    <a href='dash-profile.html' class='user-name'><strong>"+userInfo.userName+"</strong></a>\n" +
            "                </div>";

        $(".site-top-nav .site-menu > li:last-child").append(html);

    }


</script>
</body>
</html>
