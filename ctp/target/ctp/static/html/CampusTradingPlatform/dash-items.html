<!DOCTYPE html>
<html lang="en">
<head>

    <!--meta tags-->

    <meta charset="UTF-8">
    <meta name="description" content="Services Listing HTML5 CSS3 template">
    <meta name="keywords" content="HTML,CSS,XML,JavaScript, services, listing">
    <meta name="author" content="Ui-DesignLab">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--end meta tags-->

    <title>OldsMarket Dashboard</title>

    <!--stylesheets-->
    <link rel="stylesheet" href="vendor/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/css/animate.min.css">
    <link rel="stylesheet" href="vendor/css/alertify.css">
    <link rel="stylesheet" href="vendor/perfect-scrollbar/css/perfect-scrollbar.min.css">
    <link rel="stylesheet" href="vendor/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/fileinput.css">
    <link rel="stylesheet" href="css/bootstrap-fileinput.css">
    <!--end stylesheets-->

    <!--google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Cairo%7CNosifer%7CPoppins%7CQuicksand:700%7CRaleway%7CTangerine%7CHind+Vadodara" rel="stylesheet">
    <!--end google fonts-->
    <style>
        .dash-side-nav-wrapper .dash-side-nav .user-info .dash-user-img img{
            width: 56px;
            height: 56px;
        }
        .dash-pagination .current span {
            text-transform: none;
            color: #ffffff;
        }
    </style>
</head>
<body class="dashboard">

<!--top navigation-->
<div class="top-nav">
    <i class="fa fa-bars toggle-dash-menu"></i>
    <ul class="list-inline">
        <!--<li class="list-inline-item"><a href="#" class="show-search"><i class="fa fa-search"></i></a></li>-->
        <li class="list-inline-item"><a href="cart.html"><i class="fa fa-cart-arrow-down"></i><!--<span><em>4</em></span>--></a></li>
        <li class="list-inline-item"><a href="dashboard.html"><i class="fa fa-bell"></i><!--<span><em>8</em></span>--></a></li>
        <li class="list-inline-item"><a href="dash-profile.html"><i class="fa fa-user"></i></a></li>
    </ul>
</div>
<!--end top navigation-->

<!--side navigation-->
<div class="dash-side-nav-wrapper" id="dash-side-menu">
    <div class="dash-side-nav perfect-scroll">
        <div class="dash-logo">
            <h5><a href="dashboard.html">SOM二手市场</a></h5>
            <span>个人面板</span>
        </div>
        <div class="user-info">
            <div class="dash-user-img"><img src="img/user2.jpg" alt=""></div>
            <div class="dash-user-info">
                <strong>Murethi Brian  N.</strong>
                <br>
                <span>Backend Developer</span>
            </div>
            <a href="dash-profile.html" class="dash-edit-user"><i class="fa fa-pencil"></i></a>
        </div>
        <ul class="list-unstyled dash-menu">
            <li><a href="dash-profile.html"><i class="fa fa-user"></i><span>个人信息</span></a></li>
            <li><a href="dash-sales.html"><i class="fa fa-money"></i><span>交易记录</span></a></li>
            <li><a href="dash-items.html" class="current"><i class="fa fa-list-alt"></i><span>商品列表</span></a></li>
            <li><a href="dash-addItem.html"><i class="fa fa-plus-circle"></i><span>新增商品</span></a></li>
            <li><a href="index.html"><i class="fa fa-sign-out"></i><span>返回市场</span></a></li>
            <li><a href="#" id="logOut"><i class="fa fa-sign-out"></i><span>退出登陆</span></a></li>
        </ul>
    </div>
</div>
<!--end side navigation-->

<!--search box-->
<div class="dash-search-box" id="dash-search-box">
    <div class="d-search-box">
        <form action="#" method="post">
            <div class="form-group">
                <input required list="ui-list" class="form-control" type="search" placeholder="Search">
            </div>
            <button class="btn"><i class="fa fa-search"></i></button>
        </form>
        <datalist id="ui-list">
            <option>Monthly sales</option>
            <option>Salaries</option>
            <option>Invoice</option>
            <option>Messages</option>
            <option>Reviews</option>
            <option>Active items</option>
        </datalist>
    </div>
</div>
<!--end search box-->

<!--ux-box-->
<div id="ux-box" class="ux-box-wrapper">
    <div class="ux-box">
        <strong class="text-info" style="display:block;margin-top: -10px;margin-bottom: 10px">商品状态</strong>
        <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-6" >
                <div class="stt">
                    <i class="fa fa-eye fa-2x"></i>
                    <h6><strong>正在审核</strong></h6>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
                <div class="stt">
                    <i class="fa fa-paper-plane fa-2x"></i>
                    <h6><strong>已发布</strong></h6>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
                <div class="stt" style="color: #51d251;">
                    <i class="fa fa-inbox fa-2x ui-text-success"></i>
                    <h6><strong style="color: #51d251;">已售完</strong></h6>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
                <div class="stt">
                    <i class="fa fa-angle-double-down fa-2x"></i>
                    <h6><strong>已下架</strong></h6>
                </div>
            </div>

        </div>
    </div>
</div>
<!--end ux-box-->

<!--content container-->
<div class="content-wrapper">
    <!--items-->
    <div class="dash-items">
        <div class="items-mini-menu">
            <a href="dash-addItem.html"><i class="fa fa-plus-circle text-info"></i> <span><em>新增货物</em></span></a>
            <div>
                <a href="#"><i class="fa fa-check-circle-o text-success"></i> <span><em>出售</em> <em id="saleQuantity">0</em></span></a>
                <a href="#"><i class="fa fa-trash-o text-danger"></i> <span><em>已删除</em> <em id="deleteQuantity">0</em></span></a>
            </div>
        </div>

        <div class="product-items">
            <center style="color: red;font-size: 20px">
                无商品!
            </center>
            <!--<div class="product-item">
                <div class="item-img"><img src="img/item.jpg" alt=""></div>
                <div class="item-info">
                    <h5>商品标题</h5>
                    <p>
                        商品描述
                    </p>
                    <span class="text-success">出售 0</span>, <span>总数: 12</span>, <span class="text-info">发布日期: 12, Jan 2017</span>
                </div>
                <div class="item-action">
                    <a href="dash-addItem.html"><span><i class="fa fa-pencil"></i></span><em>编辑</em></a>
                    <a href="item-detail.html"><span><i class="fa fa-eye"></i></span><em>查看</em></a>
                    <a href="#" class="show-box"><span><i class="fa fa-bar-chart"></i></span><em>状态</em></a>
                    <a href="#" class="delete-item"><span><i class="fa fa-trash-o"></i></span><em>删除</em></a>
                </div>
            </div>

            <div class="product-item">
                <div class="item-img"><img src="img/item2.jpg" alt=""></div>
                <div class="item-info">
                    <h5>1990 Vintage Sports Car</h5>
                    <p>
                        Salami tail chuck, ground round ham hock jerky hamburger
                        t-bone spare ribs leberkas. Turducken pork belly lebe rkas
                        kielbasa, boudin pig pork chop beef ribs cupim hamburger sausage.
                        Pancetta drumstick ham meatloaf tongue brisket.
                        Tri-tip ham picanha doner capicola jerky, ribeye.
                    </p>
                    <span class="text-success">1 Sale</span>, <span>Quantity: 1</span>, <span class="text-info">Posted: 12, Jan 2017</span>
                </div>
                <div class="item-action">
                    <a href="dash-addItem.html"><span><i class="fa fa-pencil"></i></span><em>Edit</em></a>
                    <a href="item-detail.html"><span><i class="fa fa-eye"></i></span><em>View</em></a>
                    <a href="#" class="show-box"><span><i class="fa fa-bar-chart"></i></span><em>Stats</em></a>
                    <a href="#" class="delete-item"><span><i class="fa fa-trash-o"></i></span><em>Trash</em></a>
                </div>
            </div>
            <div class="product-item">
                <div class="item-img"><img src="img/item.jpg" alt=""></div>
                <div class="item-info">
                    <h5>Apple Supersonic Headphones</h5>
                    <p>
                        Salami tail chuck, ground round ham hock jerky hamburger
                        t-bone spare ribs leberkas. Turducken pork belly lebe rkas
                        kielbasa, boudin pig pork chop beef ribs cupim hamburger sausage.
                        Pancetta drumstick ham meatloaf tongue
                    </p>
                    <span class="text-success">0 Sales</span>, <span>Quantity: 12</span>, <span class="text-info">Posted: 12, Jan 2017</span>
                </div>
                <div class="item-action">
                    <a href="dash-addItem.html"><span><i class="fa fa-pencil"></i></span><em>Edit</em></a>
                    <a href="item-detail.html"><span><i class="fa fa-eye"></i></span><em>View</em></a>
                    <a href="#" class="show-box"><span><i class="fa fa-bar-chart"></i></span><em>Stats</em></a>
                    <a href="#" class="delete-item"><span><i class="fa fa-trash-o"></i></span><em>Trash</em></a>
                </div>
            </div>
            <div class="product-item">
                <div class="item-img"><img src="img/item2.jpg" alt=""></div>
                <div class="item-info">
                    <h5>1990 Vintage Sports Car</h5>
                    <p>
                        Salami tail chuck, ground round ham hock jerky hamburger
                        t-bone spare ribs leberkas. Turducken pork belly lebe rkas
                        kielbasa, boudin pig pork chop beef ribs cupim hamburger sausage.
                        Pancetta drumstick ham meatloaf tongue brisket.
                        Tri-tip ham picanha doner capicola jerky, ribeye.
                    </p>
                    <span class="text-success">1 Sale</span>, <span>Quantity: 1</span>, <span class="text-info">Posted: 12, Jan 2017</span>
                </div>
                <div class="item-action">
                    <a href="dash-addItem.html"><span><i class="fa fa-pencil"></i></span><em>Edit</em></a>
                    <a href="item-detail.html"><span><i class="fa fa-eye"></i></span><em>View</em></a>
                    <a href="#" class="show-box"><span><i class="fa fa-bar-chart"></i></span><em>Stats</em></a>
                    <a href="#" class="delete-item"><span><i class="fa fa-trash-o"></i></span><em>Trash</em></a>
                </div>
            </div>
            <div class="product-item">
                <div class="item-img"><img src="img/item.jpg" alt=""></div>
                <div class="item-info">
                    <h5>Apple Supersonic Headphones</h5>
                    <p>
                        Salami tail chuck, ground round ham hock jerky hamburger
                        t-bone spare ribs leberkas. Turducken pork belly lebe rkas
                        kielbasa, boudin pig pork chop beef ribs cupim hamburger sausage.
                        Pancetta drumstick ham meatloaf tongue
                    </p>
                    <span class="text-success">0 Sales</span>, <span>Quantity: 12</span>, <span class="text-info">Posted: 12, Jan 2017</span>
                </div>
                <div class="item-action">
                    <a href="dash-addItem.html"><span><i class="fa fa-pencil"></i></span><em>Edit</em></a>
                    <a href="item-detail.html"><span><i class="fa fa-eye"></i></span><em>View</em></a>
                    <a href="#" class="show-box"><span><i class="fa fa-bar-chart"></i></span><em>Stats</em></a>
                    <a href="#" class="delete-item"><span><i class="fa fa-trash-o"></i></span><em>Trash</em></a>
                </div>
            </div>
            <div class="product-item">
                <div class="item-img"><img src="img/item2.jpg" alt=""></div>
                <div class="item-info">
                    <h5>1990 Vintage Sports Car</h5>
                    <p>
                        Salami tail chuck, ground round ham hock jerky hamburger
                        t-bone spare ribs leberkas. Turducken pork belly lebe rkas
                        kielbasa, boudin pig pork chop beef ribs cupim hamburger sausage.
                        Pancetta drumstick ham meatloaf tongue brisket.
                        Tri-tip ham picanha doner capicola jerky, ribeye.
                    </p>
                    <span class="text-success">1 Sale</span>, <span>Quantity: 1</span>, <span class="text-info">Posted: 12, Jan 2017</span>
                </div>
                <div class="item-action">
                    <a href="dash-addItem.html"><span><i class="fa fa-pencil"></i></span><em>Edit</em></a>
                    <a href="item-detail.html"><span><i class="fa fa-eye"></i></span><em>View</em></a>
                    <a href="#" class="show-box"><span><i class="fa fa-bar-chart"></i></span><em>Stats</em></a>
                    <a href="#" class="delete-item"><span><i class="fa fa-trash-o"></i></span><em>Trash</em></a>
                </div>
            </div>-->
        </div>

    </div>
    <!--end items-->

    <!--page-->
    <div class="dash-pagination">
        <!--<a href="#" id="pre"><i class="fa fa-angle-left"></i></a>
        <a href="#" class="current">1</a>
        <a href="#">2</a>
        <a href="#">3</a>
        <a href="#" id="next"><i class="fa fa-angle-right"></i></a>-->
    </div>
    <!--end page-->

    <!--item profile-->
    <div class="pup" style="display: none">
        <form action="#" method="post" id="goodForm" class="profile-wrapper" enctype="multipart/form-data">
            <div class="primary-info">
                <div class="form-group">
                    <input type="hidden" id="goodsId">
                    <label for="uploadImage">商品图片</label>
                    <div class="col-md-8">
                        <div class="fileinput fileinput-new" data-provides="fileinput" id="uploadImageDiv">
                            <div class="fileinput-new thumbnail" style="width: 200px; height: 150px;">
                                <img src="img/user2.jpg" alt="" />
                            </div>
                            <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 200px; max-height: 150px;"></div>
                            <div id="changeImgOpt">
                                <span class="btn default btn-file">
                                    <span class="fileinput-new btn btn-primary">更换图片</span>
                                    <span class="fileinput-exists btn btn-primary">更改</span>
                                    <input type="file" name="uploadImage" id="uploadImage" />
                                </span>
                                <a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
                                <span style="font-size: 12px">请选择1M以内图片</span>
                            </div>
                        </div>
                        <div id="titleImageError" style="color: #a94442"></div>
                    </div>
                </div>
                <hr>
                <div class="form-group">
                    <label for="msg">商品描述</label>
                    <textarea name="msg" required id="msg" rows="5" class="form-control" placeholder="请输入商品的介绍和描述..."></textarea>
                </div>

            </div>
            <div class="secondary-info">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group">
                            <label for="fname">商品名称</label>
                            <input class="form-control" required type="text" id="fname" placeholder="请输入商品名称...">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group">
                            <label for="itemType">商品类型</label>
                            <select name="goodsTypeId" id="itemType" required class="form-control" title="">
                                <option value="all">All records</option>
                                <option value="date1">Date Listed</option>
                                <option value="date2">Date Sold</option>
                                <option value="price">Price</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <div class="form-group">
                            <label for="goodsPrice">商品二手价</label>
                            <input class="form-control" required type="text" name="goodsPrice" id="goodsPrice" placeholder="请输入本商品二手出售价格">
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="form-group">
                            <label for="goodsOriginalPrice">原价</label>
                            <input class="form-control" required type="text" name="goodsOriginalPrice" id="goodsOriginalPrice" placeholder="请输入本商品的原价">
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="form-group">
                            <label for="goodsdegree">新旧程度</label>
                            <input class="form-control" required name="goodsDegree" type="number" min="0" max="1" step="0.1" id="goodsDegree" placeholder="请输入本商品的新旧程度（0~1）">
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="form-group">
                            <label for="goodsQuantity">总量</label>
                            <input class="form-control" required type="number" min="0" name="goodsQuantity" id="goodsQuantity" placeholder="请输入本商品的数量">
                        </div>
                    </div>

                </div>
                <div class="form-group">
                    <label for="tradingPlace">商品交易地点</label>
                    <textarea name="tradingPlace" required id="tradingPlace" rows="5" class="form-control" placeholder="请输入商品的交易地点..."></textarea>
                </div>
                <div class="row" id="buttonGroup">
                    <div class="col-lg-6 col-md-6"></div>
                    <div class="col-lg-6 col-md-6">
                        <button type="button" id="saveGoods" class="ui-btn ui-btn-info">保存 <i class="fa fa-save"></i></button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!--end item profile-->

</div>
<!--end content container-->

<!--page loader-->
<div class="page-loader">
    <div class="loader"><img src="img/logo.png" alt=""></div>
</div>
<!--end page loader-->

<!--scripts-->
<script src="vendor/js/jquery-3.2.1.min.js"></script>
<script src="vendor/js/popper.js"></script>
<script src="layer/layer.js"></script>
<script src="vendor/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/bootstrap-fileinput.js"></script>
<script src="vendor/js/alertify.js"></script>
<script src="vendor/js/jquery.knob.min.js"></script>
<!--[if IE]><script type="text/javascript" src="vendor/js/excanvas.js"></script><![endif]-->
<script src="vendor/js/summernote-bs4.min.js"></script>
<script src="vendor/js/dropzone.js"></script>
<script src="vendor/OwlCarousel2-2.2.1/owl.carousel.min.js"></script>
<script src="vendor/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="vendor/js/typed.js"></script>
<script src="js/app.js"></script>
<!--end scripts-->
<script>


    /**
     * 时间戳转日期格式
     */
    function formatDate(timestamp) {
        var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
        var Y = date.getFullYear() + '-';
        var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        var D = date.getDate() + ' ';
        return Y+M+D;
    }

    var curPage = 1;
    var limit = 2;
    var resultGoods = {};

    /**
     * 登陆验证
     */
    var checkLogin = sessionStorage.getItem("userInfo");
    var userInfo = null;
    if(checkLogin == null){
        alert("未登录，请先登陆！");
        window.location.href="login-register.html";
    }else{
        userInfo = JSON.parse(checkLogin);
        $(".dash-user-img").find("img").attr("src","img/userimg/"+userInfo.headPortrait);
        $(".dash-user-info").find("strong").text("用户名："+userInfo.userName);
        $(".dash-user-info").find("span").text("真实姓名："+userInfo.realName);

    }

    /**
     * 加载个人商品信息
     */
    var setGoods = function (resultGoods,page) {
        curPage = page;
        layer.load(2,{
            shade:[0.3,'#dddddd']
        });
        $.ajax({
            url:"http://localhost:8080/ctp/user/goods/"+userInfo.id,
            type:"get",
            dataType:"json",
            data:{
                page : page,
                limit : limit,
                orderName:'createTime',
                orderType:'desc',
                goodsQuantity:2
            },
            success:function (result) {
                console.log(result);
                resultGoods = result;
                var data = result.data;

                if(result.code == 1 && result.count > 0){
                    /**
                     * 数字格式，2 --> 02
                     */
                    function quantity(quantity) {
                        if(quantity < 10 && quantity > 0){
                            return "0"+quantity;
                        }else{
                            return quantity;
                        }
                    }
                    $(".product-items").empty();
                    $(".dash-pagination").empty();
                    $("#saleQuantity").text(result.obj.saleQuantity);
                    $("#deleteQuantity").text(result.obj.deleteQuantity);
                    var html="";
                    /**
                     * 拼接个人商品
                     */
                    for(var i = 0;i<data.length;i++){
                        html +="<div class='product-item' '>\n" +
                            "                <div class='item-img'><img src='img/items/"+data[i].image+"' alt='''></div>\n" +
                            "                <div class='item-info'>\n" +
                            "                    <h5>"+data[i].goodsName+"</h5>\n" +
                            "                    <p>\n" +
                            "                        "+data[i].goodsDetail+"\n" +
                            "                    </p>\n" +
                            "                    <span class='text-success'>出售 "+data[i].saleQuantity+"</span>, <span>总数: "+data[i].goodsQuantity+"</span>, <span class='text-info'>发布日期: ";
                            if(data[i].registerTime == null ||"" == data[i].registerTime){
                                html += " 商品审核中...  暂未发布!";
                            }else{
                                html += formatDate(data[i].registerTime);
                            }
                            html +="</span>\n" +
                            "                </div>\n" +
                            "                <div class='item-action'>\n" +
                            "                    <a href='javascript:void()' goodsid='"+data[i].id+"' class='edit'><span><i class='fa fa-pencil'></i></span><em>编辑</em></a>\n" +
                            "                    <a href='javascript:void()' class='detail' goodsid='"+data[i].id+"'><span><i class='fa fa-eye'></i></span><em>查看</em></a>\n" +
                            "                    <a class='show-box'status='"+data[i].goodsStatus+"' saleNum='"+data[i].saleQuantity+"' style='cursor: pointer'><span><i class='fa fa-bar-chart'></i></span><em>状态</em></a>\n";
                        if(data[i].goodsStatus == 2 || data[i].goodsStatus == 3){
                            html +="                    <a class='sold-out'style='cursor: pointer' goodsid='"+data[i].id+"'><span><i class='fa fa-angle-double-down'></i></span><em>下架</em></a>\n";
                        }
                        html +="                    <a class='delete-item' style='cursor: pointer' goodsid='"+data[i].id+"'><span style='background: white;border: solid 1px #ff006a'><i class='fa fa-trash-o ui-text-danger' style='color: #ff006a;'></i></span><em>删除</em></a>\n" +
                            "                </div>\n" +
                            "            </div>";
                    }
                    //生成节点
                    $(".product-items").append(html);

                    /**
                     * 商品的弹框
                     */
                    var openPup = function (item,pupType) {
                        var pupIndex = layer.open({
                            type:1,
                            area:'80%',
                            title:"商品信息",
                            content:$(".pup"),
                            success:function () {
                                $(".pup").find("img").attr("src","img/items/"+item.image);
                                $("#goodsId").val(item.id);
                                $("#msg").val(item.goodsDetail);
                                $("#fname").val(item.goodsName);
                                $("#itemType").val(item.type.id);
                                $("#goodsPrice").val(item.goodsPrice);
                                $("#goodsOriginalPrice").val(item.goodsOriginalPrice);
                                $("#goodsDegree").val(item.goodsDegree);
                                $("#goodsQuantity").val(item.goodsQuantity);
                                $("#tradingPlace").val(item.tradingPlace);

                                if(pupType == 2){
                                    console.log(pupType);
                                    $("#changeImgOpt").css("display","none");
                                    $("#buttonGroup").css("display","none");
                                    $("#msg").attr("disabled", "disabled");
                                    $("#fname").attr("disabled", "disabled");
                                    $("#itemType").attr("disabled", "disabled");
                                    $("#goodsPrice").attr("disabled", "disabled");
                                    $("#goodsOriginalPrice").attr("disabled", "disabled");
                                    $("#goodsDegree").attr("disabled", "disabled");
                                    $("#goodsQuantity").attr("disabled", "disabled");
                                    $("#tradingPlace").attr("disabled", "disabled");
                                }else{
                                    $("#changeImgOpt").removeAttr("style");
                                    $("#buttonGroup").removeAttr("style");
                                    $("#msg").removeAttr("disabled");
                                    $("#fname").removeAttr("disabled");
                                    $("#itemType").removeAttr("disabled");
                                    $("#goodsPrice").removeAttr("disabled");
                                    $("#goodsOriginalPrice").removeAttr("disabled");
                                    $("#goodsDegree").removeAttr("disabled");
                                    $("#goodsQuantity").removeAttr("disabled");
                                    $("#tradingPlace").removeAttr("disabled");
                                }
                            },
                            end:function () {
                                setGoods(resultGoods,curPage);
                            }
                        });
                    };

                    /**
                     * 商品编辑
                     */
                    $(".edit").on("click",function () {
                        var goodsid =$(this).attr("goodsid");
                        console.log(goodsid);
                        $.ajax({
                            url:"http://localhost:8080/ctp/goods/"+goodsid,
                            type:"get",
                            data:{},
                            dataType:"json",
                            success:function (result) {
                                console.log(result);
                                if(result.code == 1){
                                    openPup(result.obj,1);
                                }
                            },
                            error:function () {
                                alertify.error("未知错误！请联系管理员!");
                            }
                        });

                    });

                    /**
                     * 商品查看
                     */
                    $(".detail").on("click",function () {
                        var goodsid =$(this).attr("goodsid");
                        console.log(goodsid);
                        $.ajax({
                            url:"http://localhost:8080/ctp/goods/"+goodsid,
                            type:"get",
                            data:{},
                            dataType:"json",
                            success:function (result) {
                                console.log(result);
                                if(result.code == 1){
                                    openPup(result.obj,2);
                                }
                            },
                            error:function () {
                                alertify.error("未知错误！请联系管理员!");
                            }
                        });

                    });

                    /**
                     * 商品状态
                     */
                    $('.show-box').on('click', function (e) {
                        $('.ux-box-wrapper').addClass('show-ux-box');
                        e.preventDefault();
                        var thisEle = $(this);
                        var status = $(this).attr("status");
                        console.log(status);
                        $(".ux-box").find(".row").find("i").each(function (index,ele) {
                            if(status < (index+1)){
                                $(ele).removeClass("ui-text-success");
                                $(ele).next().find("strong").removeAttr("style");
                            }else{
                                $(ele).addClass("ui-text-success");
                                $(ele).next().find("strong").css("color","#51d251");
                            }
                        });

                    });
                    $('.close-box').on('click', function (e) {
                        $('.ux-box-wrapper').removeClass('show-ux-box');
                        e.preventDefault();

                    });

                    /**
                     * 商品下架
                     */
                    $(".sold-out").on("click",function () {
                        var _myThis = $(this);
                        var goodsid = $(this).attr("goodsid");
                        alertify.confirm("你确定要下架本商品吗?", function () {
                            // userimg clicked "ok"
                            // some logic here to talk to the server
                            $.ajax({
                                url:"http://localhost:8080/ctp/goods/"+goodsid,
                                type:"put",
                                data:{
                                    goodsStatus:4
                                },
                                dataType:"json",
                                success:function (result) {
                                    if(result.statuCode == 4){
                                        // _myThis.closest('.product-item').fadeOut();
                                        alertify.success("下架成功！");
                                        setGoods(resultGoods,1);
                                    }else {
                                        alertify.error("服务器异常，请联系管理员！");
                                    }
                                },
                                error:function () {
                                    alertify.error("服务器错误！请联系管理员！");
                                }
                            })

                        }, function() {
                            // userimg clicked "cancel"
                            alertify.error("已撤销删除！")
                        });
                        e.preventDefault();
                    });

                    /**
                     * 商品删除
                     */
                    $('.delete-item').on('click', function (e) {
                        var _myThis = $(this);
                        var goodsid = $(this).attr("goodsid");
                        alertify.confirm("你确定要删除本商品吗?", function () {
                            // userimg clicked "ok"
                            // some logic here to talk to the server
                            $.ajax({
                                url:"http://localhost:8080/ctp/goods/"+goodsid,
                                type:"delete",
                                data:{},
                                dataType:"json",
                                success:function (result) {
                                    if(result.statuCode == 1){
                                        _myThis.closest('.product-item').fadeOut();
                                        $("#deleteQuantity").text(parseInt($("#deleteQuantity").text())+1);
                                        alertify.success("删除成功！");
                                    }else {
                                        alertify.error("服务器异常，请联系管理员！");
                                    }
                                },
                                error:function () {
                                    alertify.error("服务器错误！请联系管理员！");
                                }
                            })

                        }, function() {
                            // userimg clicked "cancel"
                            alertify.error("已撤销删除！")
                        });
                        e.preventDefault();
                    });

                    var pageHtml = "";
                    pageHtml += "<a href='javascript:void(0)' id='pre'><i class='fa fa-angle-left'></i></a>";
                    /**
                     * 拼接页码
                     */
                    for(var i = 0;i<result.totalPage;i++){
                        if(result.page==(i+1)){
                            pageHtml += "<a href='javascript:void(0)' class='pageNumber current'><span>"+(i+1)+"</span></a>";
                        }else{
                            pageHtml += "<a href='javascript:void(0)' class='pageNumber'><span><i>"+(i+1)+"</i></span></a>";
                        }
                    }
                    pageHtml += "<a href='javascript:void(0)' id='next'><i class='fa fa-angle-right'></i></a>";
                    $(".dash-pagination").append(pageHtml);
                    /**
                     * 页码点击
                     */
                    $(".pageNumber").on("click",function () {
                        setGoods(result,$(this).text());
                    });
                    /**
                     * 上一页点击
                     */
                    $("#pre").click(function () {
                        if(result.page ==1){
                            setGoods(result,result.page);
                        }else{
                            setGoods(result,result.page-1);
                        }
                    });
                    /**
                     * 下一页点击
                     */
                    $("#next").click(function () {
                        if(result.page ==result.totalPage){
                            setGoods(result,result.totalPage);
                        }else{
                            setGoods(result,result.page+1);
                        }
                    });
                }else if(result.code == 1 && result.count == 0){

                }
                layer.closeAll();
            },
            error:function () {
                layer.closeAll();
                alertify.error("请求出错！")
            }
        });
    };
    setGoods(resultGoods,1);


    /**
     * 商品类型列表
     */
    $.ajax({
        url:"http://localhost:8080/ctp/goods/type/0",
        type:"get",
        data:{},
        success:function (result) {
            var typeData = result.rows;
            console.log(result);
            $("#itemType").empty();
            var htmlItemType = "";
            for(var i = 0;i<typeData.length; i++){
                htmlItemType += "<option value='"+typeData[i].id+"'>"+typeData[i].typeName+"</option>";
            }
            $("#itemType").append(htmlItemType);
        },
        error:function () {
            alert("请求出错！");
        }
    });

    /**
     * 保存
     */
    $("#saveGoods").on("click",function () {

        var file = $("#uploadImage")[0].files[0];
        console.log(file);
        var goodsId = $("#goodsId").val();
        var msg = $("#msg").val();
        var fname = $("#fname").val();
        var itemType = $("#itemType").val();
        var goodsPrice = $("#goodsPrice").val();
        var goodsOriginalPrice = $("#goodsOriginalPrice").val();
        var goodsDegree = $("#goodsDegree").val();
        var goodsQuantity = $("#goodsQuantity").val();
        var tradingPlace = $("#tradingPlace").val();

        var checkLogin = sessionStorage.getItem("userInfo");
        // var userId = sessionStorage.getItem()
        if(checkLogin == null){
            alert("未登陆！请先登陆！");
        }else if(msg == ''){
            alert("商品详情不能为空！");
            $("#msg").focus();
        }else if(fname ==""){
            alert("商品名称不能为空！");
            $("#fname").focus()
        }else if(itemType == ""){
            alert("商品类型不能为空！");
            $("#itemType").focus();
        }else if(goodsPrice == ''){
            alert("商品二手价不能为空！");
            $("#goodsPrice").focus();
        }else if(goodsOriginalPrice == ''){
            alert("商品原价不能为空！");
            $("#goodsOriginalPrice").focus();
        }else if(goodsDegree == '' || goodsDegree > 1 || goodsDegree < 0){
            if(goodsDegree > 1 || goodsDegree < 0){
                alert("商品新旧程度输入有误！");
                $("#goodsDegree").focus();
            }else {
                alert("商品新旧程度不能为空！");
                $("#goodsDegree").focus()
            }
        }else if(goodsQuantity == ''){
            alert("商品总量不能为空！");
            $("#goodsQuantity").focus();
        }else if(tradingPlace == ''){
            alert("请输入商品交易地点！");
            $("#tradingPlace").focus();
        }else{
            var userInfo = JSON.parse(checkLogin);
            if(null == userInfo.identity || "" == userInfo.identity){
                alertify.error("个人信息未完善，无法申请商品发布！请完善个人信息！");
            }else{
                var formData = new FormData();
                formData.append("file",file);
                formData.append("goodsName",fname);
                formData.append("goodsTypeId",itemType);
                formData.append("goodsDetail",msg);
                formData.append("goodsDegree",goodsDegree);
                formData.append("goodsOriginalPrice",goodsOriginalPrice);
                formData.append("goodsPrice",goodsPrice);
                formData.append("goodsQuantity",goodsQuantity);
                formData.append("tradingPlace",tradingPlace);
                formData.append("userId",userInfo.id);
                formData.append("save","save");

                console.log(formData);
                var loadIndex=layer.load(2);
                $.ajax({
                    url:"http://localhost:8080/ctp/goods/"+goodsId,
                    type:"POST",
                    data:formData,
                    contentType: false,
                    cache: false,
                    processData: false,
                    success:function (result) {
                        console.log(result);
                        if(result.statuCode == 1){
                            layer.closeAll();
                            alertify.success("保存成功！");
                        }else if(result.statuCode == 10){
                            layer.alert("保存失败！文件上传错误!",{icon:5,time:2000});
                        }else {
                            layer.alert("系统繁忙！",{icon:5,time:2000});
                        }
                    },
                    error:function () {
                        layer.close(loadIndex);

                        layer.alert("服务端错误，请联系管理员！",{icon:5,time:2000},function () {
                            layer.closeAll();
                        });
                    }
                })
            }

        }

    })




</script>
</body>
</html>
